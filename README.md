[![Build Status](https://travis-ci.org/makersacademy/takeaway-challenge.svg?branch=master)](https://travis-ci.org/makersacademy/takeaway-challenge)
[![Coverage Status](https://camo.githubusercontent.com/9b8ccc8715ea3c1a108f94f7d21d1a7e41d1b36e/68747470733a2f2f636f766572616c6c732e696f2f6275696c64732f373634393335322f6261646765)](https://camo.githubusercontent.com/9b8ccc8715ea3c1a108f94f7d21d1a7e41d1b36e/68747470733a2f2f636f766572616c6c732e696f2f6275696c64732f373634393335322f6261646765)

Takeaway Challenge
==================

```
                            _________
              r==           |       |
           _  //            |  M.A. |   ))))
          |_)//(''''':      |       |
            //  \_____:_____.-------D     )))))
           //   | ===  |   /        \
       .:'//.   \ \=|   \ /  .:'':./    )))))
      :' // ':   \ \ ''..'--:'-.. ':
      '. '' .'    \:.....:--'.-'' .'
       ':..:'                ':..:'

 ```

Description
-------
The Takeaway program gives the user the possibility to check the latest menu and to easily place orders online. In case of a successful checkout the program sends a text message to the user confirming the expected delivery time.
Program uses twilio gem to send text messages to users. In order to run the program with `./lib/takeaway.rb` you will need to update your environment variables with the followings:
- `export 'TWILIO_ACC_SID'='add your twilio account_sid here'`
- `export 'TWILIO_AUTH_TOKEN'='add your twilio auth_token here'`
- `export 'TWILIO_PHONE_NR_TO'='add a phone number here to which the text message will be sent'`
- `export 'TWILIO_PHONE_NR_FROM'='add a phone number here from which the text message will be sent'`

### User stories
The program covers the following user stories:
```
As a customer
So that I can check if I want to order something
I would like to see a list of dishes with prices

As a customer
So that I can order the meal I want
I would like to be able to select some number of several available dishes

As a customer
So that I can verify that my order is correct
I would like to check that the total I have been given matches the sum of the various dishes in my order

As a customer
So that I am reassured that my order will be delivered on time
I would like to receive a text such as "Thank you! Your order was placed and will be delivered before 18:52" after I have ordered
```

Program structure
-------
The program contains the following classes:
#### TakeAway class
This class covers the client interactions with the Menu and OrderLog classes. It returns the responses to the client requests, generated by the order, orderlog or menu. The following methods are accessible from outside the class:
- `#start_order`: calls the `#start_order` method on the order_log to create a new order.
- `#show_menu`: requests the latest version of the menu, formats it and returns it to the client.
- `#add_item(dish_id, quantity)`: passes the dish and quantity to the order_log. It raises error if the quantity is not valid or the dish is not available.
- `#summary`: returns the summary of the current order, received from the OrderLog.
- `#total`: returns the total value of the current order, received from the OrderLog.
- `#checkout(amount)`: checks out the current order by calling the OrderLog. If the order is completed, a text message is sent out by using twilio gem.

#### Menu class
It understands the dishes. When the class is initialised, the `#load_menu` method is called which is responsible for loading the input file (menu.csv) and creating the dish objects based on the file content. Dishes are stored in a hash, where the key is the dish ID and the value is the dish object itself. The only method of the class is the `#menu` method that returns a copy of the hash of dishes, when it is called.

#### Dish class
Dish class is used to store dish level attributes, such as uniq ID, name and price. Usage of this class can be broadened.

#### OrderLog class
This class understands the orders and the order history. OrderLog is responsible for initialising an order (as current_order), managing it and storing the completed order in the history. The following public methods are available from outside the class:
- `#start_order`: instantiates a new order and assigns it to the `@current_order`
- `add_item(dish, quantity)`: passes the dish and quantity to the `#add_item` method of the current order. The method returns a confirmation if dish is added to the current order.
- `order_summary`: calls the `#order_summary` on current order.
- `checkout_order(amount)`: checks out the order by calling the `#checkout_order` on the current_order. If order is completed, it is added to order history and `@current_order` is emptied.
- `total`: calls the total method on the current order. If there is no current_order a new order is instantiated.

#### Order class
It contains all the attributes of an order. Separately stores all the relevant dish objects and the checkout value. The following public methods are accessible from outside the class:
- `#add_item(dish, quantity)`: used to add item to the order. Dish object is passed and stored in an order instance. The method is responsible for calculating the values of dishes too.
- `#complete?`: checks if the order is complete or not (checkout value needs to be available to be completed).
- `#order_summary`: returns the actual summary of the order.
- `#checkout_order(amount)`: order can be checked out by passing the total value of the order to it. Error is raised if the checkout value is not correct or the order does not contain any dish.
- `#total`: returns the current total value of the order.

Test
-------
### Feature test
The program's main functions are tested during feature test:
```
2.3.1 :002 > takeaway = TakeAway.new
 => #<TakeAway:0x007fc8aa24a318 ......................>
2.3.1 :003 > takeaway.show_menu
 => "ID: 1020 Name: Roasted Tomatoes, Price: 1.99 | ID: 1021 Name: Garlic Bread, Price: 2.22 | ID: 1022 Name: Garlic Bread with Mozzarella, Price: 2.98 | ID: 1023 Name: Bruschetta Originale, Price: 3.11 | ID: 1024 Name: Calamari, Price: 4.11 | ID: 1025 Name: Grand Chicken Caesar Salad, Price: 4.13 | ID: 1026 Name: Pollo Salad, Price: 4.32 | ID: 1027 Name: Bosco Salad, Price: 4.49 | ID: 1028 Name: American Pizza, Price: 5.44 | ID: 1029 Name: Margherita Pizza, Price: 5.77 | ID: 1030 Name: Veneziana Pizza, Price: 6.11 | ID: 1031 Name: Formaggi Pizza, Price: 6.59 | ID: 1032 Name: Tiramisu, Price: 3.19 | ID: 1033 Name: Chocolate Fudge Cake, Price: 3.23 | ID: 1034 Name: Vanilla Cheesecake, Price: 3.59"
2.3.1 :004 > takeaway.add_item(1028, 2)
 => "2x american pizzas have been added to your basket"
2.3.1 :005 > takeaway.add_item(1034, 3)
 => "3x vanilla cheesecakes have been added to your basket"
2.3.1 :006 > takeaway.add_item(1028, 1)
 => "1x american pizza has been added to your basket"
2.3.1 :007 > takeaway.summary
 => "American Pizza x3 = 16.32, Vanilla Cheesecake x3 = 10.77"
2.3.1 :008 > takeaway.add_item(1023, 2)
 => "2x bruschetta originales have been added to your basket"
2.3.1 :009 > takeaway.summary
 => "American Pizza x3 = 16.32, Vanilla Cheesecake x3 = 10.77, Bruschetta Originale x2 = 6.22"
2.3.1 :010 > takeaway.total
 => "Total: Â£33.31"
2.3.1 :011 > takeaway.checkout(33)
RuntimeError: Checkout amount is not correct
	.........
2.3.1 :012 > takeaway.checkout(33.31)
 => "Checkout completed. Confirmation has been sent in a text message"
```

### Unit test
The following test cases pass the unit test:

```
Menu
  #initialize
    passes the filename/path to the #foreach method
    returns warning if wrong filename/path is passed to foreach method
  #menu
    returns a copy of the original menu

OrderLog
  #start_order
    instantiate an order and assign it to the current_order
    raises error if there is a current order
  #add_item
    returns confirmation if 1 item is added to the order
    returns confirmation if 2 or more items are added to the order
  #order_summary
    calls the order_summary on the order
  #checkout_order
    passes the amount to the order
    records the completed order in the order history
    set the current order to nil
  #total
    calls the total method on the order

Order
  #add_item
    adds an item to the entire order
    groups the same dishes into one item
  #complete?
    returns false if the order is not complete
    returns true if the order is complete
  #checkout_order
    finalises order, by recording the checkout value
    raises error if the method is called but no dish was recorded
    raises error if the received amount is different, than total
  #total
    returns zero if no dish added to the order
    returns the total value of the current order
  #order_summary
    returns the summary of the current order

TakeAway
  #start_order
    calls the start_order method on the order_log
  #show_menu
    calls the the #menu on Menu
    returns a formatted menu
  #add_item
    passes the item to the order log
    raises error if quantity is less than 1
    raises error if the quantity is not a fixnum
    raises error if dish is not available
  #summary
    calls order_summary on the order log
  #total
    calls total method on order log
  #checkout
    passes the checkout value to the order_log
    sends confirmation text message
    returns confirmation if checkout is completed
```
