require 'twilio-ruby'
require 'order'
require 'dishes'
class Takeaway

  attr_reader :menu
  
  def initialize 
    @menu = Dishes.new.dishes
    @order = Order.new
  end

  def show_menu
    puts @menu
    @menu
  end

  def add_item(dish, quantity = 1)
    @order.add_to_basket(dish, quantity)
    puts " #{quantity}x #{dish} added to your order. "
  end

  def basket
    @order.order_basket
  end

  def total
    puts "Â£#{'%.2f' % @order.total}"
  end

  def summary
    puts @order.summary
  end

  def confirmation
    time = Time.now + 3600 
    time = time.strftime("%k:%M")
    message = "Thank you! Your order was placed and will be delivered by #{time}"
    send_sms(message)
  end

  def send_sms(message)
    account_sid = ENV['TWILIO_ACC_SID']
    auth_token = ENV['TWILIO_AUTH_TOKEN']
    @client = Twilio::REST::Client.new(account_sid, auth_token)
    message = @client.messages
      .create(
        body: message,
        from: ENV['TWILIO_PHONE_NUMBER'],
        to: ENV['PHONE_NUMBER']
      )
  end

end
